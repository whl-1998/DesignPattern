### 门面模式的原理与实现

门面模式为子系统提供一组统一的接口，定义一组高层接口让子系统更易用。

简单举个例，就假设有一个系统A、对外提供了a、b、c、d四个接口；系统B需要调用系统A的a、b、d接口。那么利用门面模式，我们可以提供一个包括a、b、d接口的门面接口x，给系统b直接调用。

你可能会认为，系统B直接调用系统A的a、b、d接口并没有太大问题，那么为什么还要提供这么一个接口x呢？

假设系统A是一个后端服务器；系统B是一个App客户端，通过后端服务器来获取数据。我们知道App与服务器之间是通过移动网络通信的，网络通信耗时较多，因此为了提高App的响应速度，我们要尽量减少App与服务器之间的网络通信次数。

假设App客户端为了完成某个业务功能（例如显示某个页面）需要依次调用a、b、d三个接口，且因自身业务特点不支持并发调用者三个接口。如果我们发现App客户端响应比较慢，且经过排查之后，发现问题出在：过多的接口调用导致过多的网络通信。这时我们就可以通过门面模式，让App客户端仅调用一次接口就获取到全部数据，将网络通信从3次减少到1次，从而提高App响应速度。



### 门面模式的应用场景举例

Gof中的定义提到，“门面模式让子系统更加易用”。但实际上门面模式除了解决易用性问题以外，还可以解决其他很多方面的问题。下面是3个常用的应用场景：

1. 解决易用性问题

   门面模式可以用来封装系统的底层实现，隐藏系统的复杂性，提供一组更加简单易用、更高层次的接口。

   例如Linux系统调用的函数就可以看作是一种 “门面”。它是Linux操作系统暴露给开发者的一组特殊的编程接口，封装了底层更基础的Linux内核调用。

   再比如Linux的Shell命令，实际上也可以看作是门面模式的应用，它封装系统层指令，提供更加友好、简单的命令，使我们能够直接执行命令与操作系统交互。

2. 解决性能问题

   也就是之前的示例中，将多个接口调用替换为一个门面接口调用，以此减少网络通信成本，进而提高App客户端响应速度。

3. 解决分布式事务问题

   假设金融系统中，有两个业务领域模式 —— 用户、钱包。这两个模型都对外暴露了一系列接口，例如用户的增删改查、钱包的增删改查等。当用户注册时，我们不仅需要创建用户（数据库User表中添加字段），还需要给用户创建一个钱包（数据库Wallet表中添加字段）。

   对于上述需求，我们可以依次调用用户的创建接口和钱包的创建接口来完成。但是用户的注册操作需要支持事务，创建用户和钱包这两个操作必须同时成功或失败，而支持两个接口调用在一个事务中执行是比较复杂的。虽然我们可以通过引入分布式事务框架或事后补偿机制解决，但代码实现都比较复杂。

   最简单的解决方式是，利用数据库事务机制或Spring提供的事务管理器，在一个事务中执行创建用户和创建钱包这两个SQL操作。这就要求两个SQL操作需要在同一个接口中完成。因此我们可以通过门面模式，设计一个新接口封装这两个SQL操作。